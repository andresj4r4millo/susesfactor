function SFPeoplePickerModel(e){this._init(e)}(function(){function e(){for(var e in"undefined"!=typeof Quickcard&&(n.quickcardFactory=Quickcard.newInstance),o){var t=window[e];"undefined"!=typeof t&&(n[e]=t)}}var t=juic.Logger.getLogger("SFPeoplePickerModel"),o={viewType:"PEOPLE_NAVIGATION_VIEW_TYPE",viewId:"PEOPLE_NAVIGATION_VIEW_VIEWID"};juic.extend(SFPeoplePickerModel,juic.EventTarget,{defaults:{controller:void 0,quickcardFactory:void 0,viewType:"peopleprofile",viewId:"peopleprofile",enableQuickcard:!0,enablePhoto:!0,enableItemPhoto:!0,enableInactiveSearch:null,uriNavigate:!0,useGenericGroups:!1,includeInactive:!1,nameWrapThreshold:0,maxWidth:null,middleInitial:"",customClass:null,popupWidth:null,themeType:"light",popupMatchWidth:!0,fetchDelay:900},validation:{controller:["object",null],quickcardFactory:["function",null],viewType:["string",null],viewId:["string",null],nameWrapThreshold:["number",null],maxWidth:["number",null],customClass:["string",null],popupWidth:["number",null],themeType:["light","dark"]},_controllerName:"peopleNavigationController",_init:function(t){e(),this._config=new juic.Config(t,this.defaults,this.validation),this._config.formattedFullName&&(this._config.fullName=this._config.formattedFullName),"object"==typeof this._config.controller?this._controller=this._config.controller:(this._controller=AjaxService.getMBeanInstance(this._controllerName),juic.assert(this._controller,"SFPeoplePickerModel: AjaxService \""+this._controllerName+"\" is missing.")),0==this._config.nameWrapThreshold&&(this._config.nameWrapThreshold=this._config.enableQuickcard?290:265),this._selectedUser={userId:this._config.userId,fullName:this._config.fullName,firstName:this._config.firstName,lastName:this._config.lastName,middleInitial:this._config.middleInitial,photoSrc:this._config.photoSrc},this._focusIndex=-1},_getEmployeesHierarchy:function(e,t){var o=this;return this._controller.getEmployeesHierarchy(e,{callback:function(e){["managers","peers","reports"].forEach(function(t){e[t]=o._formatUsers(e[t])}),t.callback.call(window,e)},errorHandler:t.errorHandler})},_findUser:function(e,t){var o=this;return this._controller.findUser(e,this._config.includeInactive,{callback:function(e){e.result=o._formatUsers(e.result),t.callback.call(window,e)},errorHandler:t.errorHandler})},_formatUsers:function(e){return e&&e.forEach(function(e){e.fullName=SFNameFormatter.format(e)}),e},_getPermittedURL:function(e,t){return this._controller.getPermittedURL(e,this._config.viewType,this._config.viewId,t)},_refreshHierarchy:function(){var e=this;this.setLoading(!0),this._getEmployeesHierarchy(this.getSelectedUserId(),{callback:function(t){e._hierarchy=t,e.setLoading(!1),e.dispatch("changeHierarchy",{hierarchy:t})},errorHandler:function(o,s){t.error(o,s),e.setLoading(!1),e.dispatch("error",{msg:MSGS.COMMON_AJAX_DEFAULT_ERROR})}})},_refreshSearchResults:function(){var e=this;null!=this._fetchTimeout&&(clearTimeout(this._fetchTimeout),this._fetchTimeout=null);var o=this._keyword;o?this._fetchTimeout=setTimeout(function(){e.setLoading(!0),e._findUser(o,{callback:function(t){e.setLoading(!1),o==e._keyword&&(e._results=t,e.dispatch("changeResults",{results:t}))},errorHandler:function(s,n){e.setLoading(!1),o==e._keyword&&(t.error(s,n),e.dispatch("error",{msg:MSGS.COMMON_AJAX_DEFAULT_ERROR}))}}),e._fetchTimeout=null},this._config.fetchDelay):this.reset()},_navigateTo:function(e){Util.gotoURL(e)},_showInvalidAccess:function(){SFMessageBox.show({escapeHTML:!1,content:"<div class='accessdeniedBox'>"+MSGS.COMMON_PEOPLE_SELECT_NO_ACCESS+"</div>",title:MSGS.COMMON_PEOPLE_SELECT_NO_ACCESS_TITLE,width:320})},setSelectedPerson:function(e){if(this._config.uriNavigate){var t=this;this._getPermittedURL(e.userId,{callback:function(e){e?t._navigateTo(e):t._showInvalidAccess()}})}else this._selectedUser=e,this._hierarchy=null,this.dispatch("personSelected",{user:this._selectedUser})},showQuickcard:function(e){this.dispatch("showQuickcard",e)},reset:function(){this.setFocusIndex(-1),this.setKeyword("")},setKeyword:function(e){this._keyword=e||"",this.dispatch("changeKeyword",{keyword:e}),e?this._refreshSearchResults():this._hierarchy?this.setMode("hierarchy"):this._refreshHierarchy()},getKeyword:function(){return this._keyword},setOriginWidth:function(e){this._config.popupMatchWidth&&(this._originWidth=e,this.dispatch("changeWidth",{width:e}))},getOriginWidth:function(){return this._originWidth},isEnableInactiveSearch:function(){if(null!=this._config.enableInactiveSearch)return this._config.enableInactiveSearch;return!!this._hierarchy&&this._hierarchy.inactiveSearchEnabled},setIncludeInactive:function(e){this._config.includeInactive=e,this._refreshSearchResults()},getHasMiddleNamePermission:function(){return this._haveMiddleNamePermission},getSelectedUser:function(){return this._selectedUser},getSelectedUserId:function(){return this._selectedUser.userId},getNameLines:function(){return!this._selectedUser.fullName||this._selectedUser.firstName&&this._selectedUser.lastName?SFNameFormatter.splitFullName(this._selectedUser):[this._selectedUser.fullName]},_getHierarchyDisablePhoto:function(){return this._hierarchy&&this._hierarchy.photoDisabled},getEnablePhoto:function(){return!this._getHierarchyDisablePhoto()&&this._config.enablePhoto},getEnableItemPhoto:function(){return!this._getHierarchyDisablePhoto()&&this._config.enableItemPhoto},getHierarchy:function(){return this._hierarchy},getSearchResults:function(){return this._results},getLoading:function(){return null!=this._loading&&0<this._loading},setLoading:function(e){this._loading=(this._loading||0)+(e?1:-1),this.setMode(0==this._loading?this._keyword?"searchResults":"hierarchy":"loading")},setMode:function(e){e!=this._mode&&(this.setFocusIndex(-1),this._mode=e,this.dispatch("changeMode",{mode:e}))},getMode:function(){return this._mode},getConfig:function(){return this._config},setSearchActiveItemId:function(e){this.dispatch("changeSearchActiveItem",{id:e})},isValidFocusIndex:function(e){return"number"==typeof this._maxFocusIndex&&-1<=e&&e<=this._maxFocusIndex},setHierarchyCount:function(e){this._heirarchyCount=e},getFocusIndex:function(){return this._focusIndex},setFocusIndex:function(e){if(this.isValidFocusIndex(e)&&e!=this._focusIndex){var t=this._focusIndex;return this._focusIndex=e,this.dispatch("focusIndexChanged",{previousFocusIndex:t,focusIndex:this._focusIndex}),!0}return!1},setMaxFocusIndex:function(e){this._maxFocusIndex=e},moveFocusUp:function(){this.setFocusIndex(this._focusIndex-1)},moveFocusDown:function(){this.setFocusIndex(this._focusIndex+1)},selectFocus:function(){0<=this._focusIndex&&this.dispatch("selectFocus")}});var s=SFPeoplePickerModel.prototype,n=s.defaults;for(var i in n)(function(e,t){s["get"+t]=s["get"+t]||function(){return this._config[e]},s["set"+t]=s["set"+t]||function(t){this._config[e]=t}})(i,i.charAt(0).toUpperCase()+i.substring(1));["userId","photoSrc","fullName","firstName","middleInitial","lastName"].forEach(function(e){var t=e.charAt(0).toUpperCase()+e.substring(1);s["get"+t]=function(){return this._selectedUser&&this._selectedUser[e]},s["set"+t]=function(t){var o=this._selectedUser=this._selectedUser||{};o[e]=t,"fullName"==e&&t&&t!==SFNameFormatter.format({firstName:o.firstName,mi:o.middleInitial,lastName:o.lastName})&&(o.firstName=o.lastName=o.middleInitial=null),this.dispatch("userChanged")}})})();function SFPeopleSearchBox(e){this.register(),this._init(e)}(function(){var e=juic.Logger.getLogger("SFPeopleSearchBox");juic.extend(SFPeopleSearchBox,juic.Component,{_init:function(e){this._model=e,this._model.addEventListener("changeKeyword",this,"_onKeywordChange"),this._model.addEventListener("changeHierarchy",this,"_onHierarchyChange"),this._model.addEventListener("changeSearchActiveItem",this,"_onChangeSearchActiveItem"),this._includeInactive=new SFCheckBox(this._model.getIncludeInactive(),null,MSGS.COMMON_PEOPLE_SELECT_INACTIVE_EMPLOYEE_SEARCH),this._includeInactive.addEventListener("change",this,"_onChangeIncludeActive"),this.minSearchKeyLength=2},renderHtml:function(e){var t=this._model.getKeyword();e.push("<div id=\"",this.id,"\" class=\"sfPeopleSearchBox\">"),e.push("<input id=\"",this.getReferenceId(),"\" role=\"combobox\" aria-autocomplete=\"list\" class=\"input\" onkeydown=\"",this.fireCode("_onKeyDown"),"\" onkeyup=\"",this.fireCode("_onKeyUp"),"\""),null!=t&&e.push(juic.escapeHTML(t)),e.push("><span class=\"peopleSearchIcon\"></span><a href=\"javascript:void(0);\" rel=\"noopener\" class=\"clearButton\" onclick=\"",this.fireCode("_onClear"),"\" title=\"",MSGS.COMMON_AutoComplete_Clear,"\"></a>"),e.push("</div><div id=\"",this.id,"includeInactive\" class=\"",this._getInactiveSearchClassName(),"\">",this._includeInactive,"</div>")},cleanup:function(){this._model.removeEventListener("changeKeyword",this),this._model.removeEventListener("changeHierarchy",this),this._model.removeEventListener("changeSearchActiveItem",this),this._includeInactive.cleanup(),this._super()},setFocus:function(e){SFDom.setFocus(this.id+"input",e)},getReferenceId:function(){return this.id+"input"},_onHierarchyChange:function(e){var t=juic.$(this.id+"includeInactive");t&&(t.className=this._getInactiveSearchClassName(),this.dispatch("changeDimensions"))},_getInactiveSearchClassName:function(){return"includeInactive"+(this._model.isEnableInactiveSearch()?" hasInactiveSearch":"")},_updateContent:function(){var e=juic.$(this.id);if(e){var t=juic.createRenderContext();this._renderContent(t),t.renderInto(e),this.dispatch("changeDimensions")}},_onChangeIncludeActive:function(e){this._model.setIncludeInactive(this._includeInactive.isChecked())},_onKeyDown:function(e){switch(e=e||window.event,SFDOMEvent.getKeyName(e)){case"ARROWUP":case"ARROWDOWN":SFDOMEvent.preventDefault(e);}},_onKeyUp:function(e){switch(e=e||window.event,SFDOMEvent.getKeyName(e)){case"ARROWUP":this._moveFocusUp();break;case"ARROWDOWN":this._moveFocusDown();break;case"RETURN":this._selectFocus();break;case"BACKSPACE":case"ALPHA":case"NUMERIC":case"SPACEBAR":case"OTHER":this._updateKeyword();break;default:}},_moveFocusUp:function(){this._model.moveFocusUp()},_moveFocusDown:function(){this._model.moveFocusDown()},_selectFocus:function(){this._model.selectFocus()},_onChangeSearchActiveItem:function(e){var t=juic.$(this.getReferenceId());t&&t.setAttribute("aria-activedescendant",e.id)},_updateKeyword:function(){var e=juic.$(this.id+"input").value;e.length>=this.minSearchKeyLength?this._model.setKeyword(e):this._model.setKeyword("");var t=juic.$(this.id);t&&SFDom[e?"addClass":"removeClass"](t,"hasKeyword")},_onKeywordChange:function(e){var t=e.keyword||""},_onClear:function(){var e=juic.$(this.id+"input");e&&(e.value="",SFDom.setFocus(e),this._updateKeyword()),this._model.setKeyword("")}})})();function SFPersonItem(e){this.register(),this._init(e)}(function(){var e=juic.Logger.getLogger("SFPersonItem"),t={},o={model:SFPeoplePickerModel,user:{userId:"string",firstName:["string",null],middleInitial:["string",null],lastName:["string",null],title:["string",null],photoSrc:["string",null],isContingentWorker:["string",null]}};juic.extend(SFPersonItem,juic.Component,{_init:function(e){if(e=new juic.Config(e,t,o),this._mode=e.mode,this._user=e.user,this._model=e.model,this._model.addEventListener("changeWidth",this,"_updateLongName"),this._model.addEventListener("selectFocus",this,"_onSelectFocus"),this._model.addEventListener("changeMode",this,"_updateClassName"),this._model.getEnableItemPhoto()){var s=this._user.userId,n=this._user.photoSrc;if(!n){var i=this._user.photoMod;!i&&this._user.photoId&&this._user.photoLastModified&&(i=SFPhoto.getPhotoMod(this._user.photoId,this._user.photoLastModified)),n={urlType:SFPhoto.URL_TYPE_EDU,photoType:SFPhoto.PHOTO_TYPE.QUICK_CARD,userId:s,mod:i}}this._photo=new SFPhoto({userId:s,photoSrc:n},{profile:"SQUARE_50"})}},renderHtml:function(e){var t=this._user.title,o=this.getFullName();t&&(o=MSGS.get("COMMON_Name_Title_Tooltip",o,t)),this._user.isContingentWorker&&"true"===this._user.isContingentWorker&&e.push("<div class=\"bizXPSIContingent\">",juic.escapeHTML(MSGS.COMMON_Contingent_Worker),"</div>"),e.push("<a id=\"",this.getReferenceId(),"\" href=\"javascript:void(0)\" rel=\"noopener\" class=\"",this._getClassName(),"\" onclick=\"",this.fireCode("_onSelectPerson"),"\" role=\"menuitem\" title=\"",juic.escapeHTML(o),"\" aria-label=\" \">",this._photo),e.push("<div id=\"",this.id,"personContent\" class=\"personContent\">"),e.push("<div class=\"name\">"),this._model.getEnableQuickcard()&&e.push("<button id=\"",this.id,"qc\" class=\"cardButton\" onclick=\"",this.fireCode("_showQC"),"\"></button>"),e.push("<span id=\"",this.id,"fullName\" class=\"fullName\">",this._getHighlightedFullName(),"</span>"),e.push("</div>"),t&&e.push("<div class=\"title\">",juic.escapeHTML(t),"</div>"),e.push("</div>"),e.push("</a>"),e.addAfterRenderListener(this,"_updateLongName")},_getHighlightedFullName:function(){var e=juic.escapeHTML(this.getFullName()),t=this._model.getKeyword();return t&&(e=e.replace(new RegExp("("+RegExp.escape(juic.escapeHTML(t))+")","i"),"<em>$1</em>")),this._user.inactive&&(e=MSGS.get("COMMON_User_Name_Inactive",e)),e},getFullName:function(){if(this._user.fullName)return this._user.fullName;var e=this._user.middleInitial||"";return this._model.getHasMiddleNamePermission()||(e=""),MSGS.get("COMMON_User_Display_Name",this._user.firstName,e,this._user.lastName)},_updateClassName:function(){var e=juic.$(this.id);e&&(e.className=this._getClassName())},_getClassName:function(){var e=["personItem"];return this._model.getEnableItemPhoto()&&e.push("hasPhoto"),this._model.getEnableQuickcard()&&e.push("hasCard"),this._user.title&&e.push("hasTitle"),this._focused&&this._mode==this._model.getMode()&&e.push("focused"),e.push(this._longName?"longName":"shortName"),e.join(" ")},cleanup:function(){this._photo&&this._photo.cleanup(),this._model.removeEventListener("changeWidth",this),this._super()},setFocused:function(e){this._focused=e,this._updateClassName(),this._focused&&this._mode==this._model.getMode()&&this._model.setSearchActiveItemId(this.getReferenceId())},_showQC:function(e){SFDOMEvent.stopPropagation(e),this._model.showQuickcard({user:this._user,refocusRef:this.id+"qc",originId:this.id})},_updateLongName:function(){},_onSelectPerson:function(){this._model.setSelectedPerson(this._user)},_onSelectFocus:function(){this._focused&&this._mode==this._model.getMode()&&this._onSelectPerson()}})})();function SFPersonItemList(e){this.register(),this._init(e)}(function(){var e=juic.Logger.getLogger("SFPersonItemList"),t={escapeHTML:!0},o={model:SFPeoplePickerModel,header:["string",null],people:[juic.Config.arrayType("object"),SFDefaultListModel,null]};juic.extend(SFPersonItemList,juic.Component,{_init:function(e){e=new juic.Config(e,t,o),this._model=e.model,this._header=e.header,this._escapeHTML=e.escapeHTML,this._mode=e.mode,Array.isArray(e.people)&&(e.people=new SFDefaultListModel(e.people)),this._list=e.people instanceof SFDefaultListModel?e.people:new SFDefaultListModel([]),this._indexOffset=e.indexOffset||0,this._people=new SFListContainer(new SFFactoryListModel({model:this._list,factory:this._createPerson,context:this})),this._model.addEventListener("focusIndexChanged",this,"_onFocusIndexChanged")},renderHtml:function(e){e.push("<div id=\"",this.id,"\" class=\"menuContainer\">"),this._header&&(e.push("<div class=\"header\">"),"string"==typeof this._header&&this._escapeHTML?e.push(juic.escapeHTML(this._header)):e.push(this._header),e.push("</div>")),e.push(this._people,"</div>")},cleanup:function(){this._people.cleanup(),this._model.removeEventListener("focusIndexChanged",this),this._super()},setPeople:function(e){this._list.setItems(e)},getListModel:function(){return this._list},_createPerson:function(e,t){var o=new SFPersonItem({model:this._model,user:e,mode:this._mode});return t==this._model.getFocusIndex()-this._indexOffset&&o.setFocused(!0),o},_onFocusIndexChanged:function(e){var t=e.previousFocusIndex-this._indexOffset,o=e.focusIndex-this._indexOffset;if(0<=t&&t<this._list.size()){var s=this._people.get(t);s&&s.setFocused(!1)}if(0<=o&&o<this._list.size()){var s=this._people.get(o);s&&s.setFocused(!0)}}})})();function SFPeopleHierarchy(e){this.register(),this._init(e)}(function(){var e=juic.Logger.getLogger("SFPeopleHierarchy"),t=[{id:"managers",label:MSGS.Managers},{id:"peers",label:MSGS.COMMON_PEOPLE_SELECT_PEERS},{id:"reports",label:MSGS.COMMON_PEOPLE_SELECT_DIRECT_REPORTS}];juic.extend(SFPeopleHierarchy,juic.Component,{_init:function(e){juic.assert(e instanceof SFPeoplePickerModel,"SFPeopleHierarchy: Invalid model"),this._model=e,this._model.addEventListener("changeHierarchy",this,"_updateHierarchy"),this._model.addEventListener("changeMode",this,"_updateMaxFocusIndex")},renderHtml:function(e){e.push("<div id=\"",this.id,"\" class=\"sfPeopleHierarchy\">"),this._renderContent(e),e.push("</div>")},cleanup:function(){this._cleanupGroups(),this._model.removeEventListener("changeHierarchy",this),this._super()},_renderContent:function(e){e.push(this._groups)},_updateContent:function(){var e=juic.$(this.id);if(e){var t=juic.createRenderContext();this._renderContent(t),t.renderInto(e),this.dispatch("changeDimensions")}},_updateMaxFocusIndex:function(){"hierarchy"==this._model.getMode()&&this._model.setMaxFocusIndex(this._peopleCount-1)},_updateHierarchy:function(e){this._cleanupGroups(),this._groups=[];var o=e.hierarchy,s=0;t.forEach(function(e){var t=o[e.id];t&&0<t.length&&(this._groups.push(new SFPersonItemList({header:e.label,model:this._model,people:t,indexOffset:s,mode:"hierarchy"})),s+=t.length)},this),this._peopleCount=s,this._updateContent(),this._updateMaxFocusIndex()},_cleanupGroups:function(){this._groups&&this._groups.forEach(function(e){e.cleanup()})}})})();function SFPeopleSearchResults(e){this.register(),this._init(e)}(function(){var e=juic.Logger.getLogger("SFPeopleSearchResults");juic.extend(SFPeopleSearchResults,juic.Component,{_init:function(e){juic.assert(e instanceof SFPeoplePickerModel,"SFPeopleSearchResults: Invalid model"),this._model=e,this._model.addEventListener("changeResults",this,"_onChangeResults"),this._list=new SFPersonItemList({model:this._model,mode:"searchResults"})},renderHtml:function(e){e.push("<div id=\"",this.id,"\" class=\"sfPeopleSearchResults\">",this._list,"<div id=\"",this.id,"noResults\" class=\"noResults\">",MSGS.COMMON_No_Result,"</div></div>")},cleanup:function(){this._list.cleanup(),this._super()},_onChangeResults:function(e){var t=e.results.result||[],o=juic.$(this.id+"noResults"),s=0<t.length;this._list.setPeople(t);var n=juic.$(this.id);n&&SFDom[s?"addClass":"removeClass"](n,"hasResults"),"searchResults"==this._model.getMode()&&this._model.setMaxFocusIndex(t.length-1),this._moreResults=e.results.moreResults,this.dispatch("changeDimensions")}})})();function SFPeoplePickerPopup(e){this.register(),this._init(e)}(function(){function e(){this.register()}var t=200,o=50,s=juic.Logger.getLogger("SFPeoplePickerPopup"),n=!!(window.sap&&sap.m&&sap.m.Bar&&sap.m.Button);juic.extend(SFPeoplePickerPopup,SFAbstractPositionable,{_init:function(e){if(juic.assert(e instanceof SFPeoplePickerModel,"SFPeoplePickerPopup: Invalid model"),this._model=e,this._model.addEventListener("changeWidth",this,"_updateStyles"),this._model.addEventListener("changeMode",this,"_onModeChanged"),this._model.addEventListener("changeSearchActiveItem",this,"_onChangeSearchActiveItem"),n){var t=this;this._bar=new sap.m.Bar({contentMiddle:new sap.m.Text({text:MSGS.SelectEmployee}),contentRight:new sap.m.Button({text:MSGS.COMMON_Cancel,press:[this._onCloseAction,this]}),visible:!1})}else this._closeButton=new SFCommandButton(MSGS.COMMON_Cancel),this._closeButton.addEventListener("action",this,"_onCloseAction");this._searchBox=this._createSearchBox(),this._searchBox.addEventListener("changeDimensions",this,"_resetHeight");var o=this._getLayoutItems();o.forEach(function(e){e.addEventListener("changeDimensions",this,"_reposition")},this),this._layout=new SFCardLayout(o)},renderHtml:function(e){e.push("<div id=\"",this.id,"\" class=\"",this._getClassName(),"\""),SFDom.renderStyle(e,this._getOuterStyle()),e.push(">"),n?e.push(this._bar):(e.push("<h3 class=\"pickerTitle\">"),e.push("<div class=\"pickerControls\">",this._closeButton,"</div>"),e.push("<span class=\"titleContent\">",MSGS.SelectEmployee,"</span><div style=\"clear:both\"></div></h3>")),e.push(this._searchBox),e.push("<div class=\"layoutContent\" id=\"",this.id,"content\""),SFDom.renderStyle(e,this._getContentStyle()),e.push(">",this._layout,"</div>"),e.push("</div>"),e.addAfterRenderListener(this,"_postRender")},_postRender:function(){this._attached||(this._attached=!0,SFBodyEventDispatcher.addResizeListener(this,"_reposition"))},cleanup:function(){this._cardLayout&&this._cardLayout.cleanup(!0),n?this._bar.destroy():this._closeButton.cleanup(),this._model.removeEventListener("changeWidth",this),this._attached&&(this._attached=!1,SFBodyEventDispatcher.removeResizeListener(null,this)),this._super()},positionFixed:function(e){this._fullScreen=!1,this._height=e.newComponentHeight,this._updateStyles()},handleFullScreenResize:function(e,t){this._fullScreen=!0,this._viewportDimensions=e,this._updateStyles(),t&&this._searchBox.setFocus(!0)},_onCloseAction:function(){this.dispatch("hide")},_reposition:function(e){if(!0===e)this.dispatch("reposition");else if(null==this._throttleId){var t=this;this._throttleId=setTimeout(function(){t._throttleId=null,t._reposition(!0)},10)}},_resetHeight:function(){if(!this._fullScreen){var e=juic.$(this.id+"content");e&&(e.style.height="auto",e.style.overflow="visible",this._reposition(!0))}},_updateStyles:function(){var e=juic.$(this.id);e&&(e.className=this._getClassName(),SFDom.updateStyle(e,this._getOuterStyle()));var t=juic.$(this.id+"content");if(n&&this._bar.setVisible(!!this._fullScreen),t)if(this._fullScreen){t.style.height="10px",t.style.overflow="hidden";var s=SFDom.getY(t),i=SFDom.getPadding(t)+SFDom.getBorder(t);this._contentHeight=this._viewportDimensions.height-s-i,t.style.overflow="auto",t.style.height=this._contentHeight+"px"}else if(this._height){e.style.height="auto",t.style.height="10px",t.style.overflow="hidden";var r=e.offsetHeight-10,a=t.scrollHeight+r-this._height+o;0<a?(this._contentHeight=this._height-r-o-SFDom.getPadding(t)-SFDom.getBorder(t),t.style.height=this._contentHeight+"px",t.style.overflow="auto",this._reposition(!0)):(t.style.height="auto",t.style.overflow="visible")}},_getOuterStyle:function(){var e=Math.max;if(this._fullScreen)return{width:this._viewportDimensions.width+"px",height:this._viewportDimensions.height+"px"};return this._model.getOriginWidth()?{width:e(this._model.getOriginWidth(),200)+"px"}:void 0},_getContentStyle:function(){return null==this._contentHeight?{overflow:"visible",height:"auto"}:{overflow:"auto",height:this._contentHeight+"px"}},_getLayoutItems:function(){return this._loading=this._createLoading(),this._hierarchy=this._createHierarchy(),this._searchResults=this._createSearchResults(),[this._loading,this._hierarchy,this._searchResults]},_createLoading:function(){return new e},_createSearchBox:function(){return new SFPeopleSearchBox(this._model)},_createHierarchy:function(){return new SFPeopleHierarchy(this._model)},_createSearchResults:function(){return new SFPeopleSearchResults(this._model)},_onModeChanged:function(e){var t=this["_"+e.mode];this._layout.setSelectedCard(t),this._resetHeight()},_getClassName:function(){var e=["sfPeoplePickerPopup"];return this._fullScreen?e.push("peoplePickerFullScreen"):e.push("peoplePickerDesktop"),e.push(AccessibilityPrefs.getLowVisionType()+"LowVision"),e.join(" ")},_getAutoScroller:function(){return this._autoScroller||(this._autoScroller=new SFAutoScroller({scrollEl:this.id+"content"})),this._autoScroller},_onChangeSearchActiveItem:function(e){this._getAutoScroller().scrollTo(SFDom.getRegion(e.id))}}),juic.extend(e,juic.Component,{renderHtml:function(e){e.push("<div class=\"sfLoadingContainer\"><span class=\"white\">",MSGS.COMMON_loading,"</span></div>")}})})();function SFPeoplePicker(e){this.register(),this._init(e)}(function(){var e=juic.Logger.getLogger("SFPeoplePicker"),t="globalHumanistText sfPeoplePicker globalModulePicker globalPlacematNavigationText",o=Util.browserInfo.ios||Util.browserInfo.android,s=768,n={showCloseIconByDefault:!0,preventCleanup:!0,autoCleanup:!1},i={visibleOverflow:!0,closeOnEscape:!0,closeOnClick:!0,menu:{horizontal:"left",vertical:"top"},origin:{horizontal:"right",vertical:"top"},offset:{horizontal:5,vertical:0}};juic.extend(SFPeoplePicker,SFAbstractDropComponent,{_init:function(e){this._cards={},this._customClass=e.customClass,this._clickablePhoto=e.clickablePhoto,this._ariaDescription="Carla Grant",this._model=this._createModel(e),this._model.addEventListener("personSelected",this,"_onUserChanged"),this._model.addEventListener("userChanged",this,"_onUserChanged"),this._model.addEventListener("showQuickcard",this,"_onShowQuickcard"),this._initPhoto(),this._super()},_initPhoto:function(){if(this._photo&&this._photo.cleanup(),this._model.getEnablePhoto()){var e=this._model.getSelectedUser();this._photo=new SFPhoto({userId:e.userId,photoSrc:e.photoSrc},{profile:"SQUARE_50"})}else this._photo=null},renderHtml:function(e){this._super(e)},renderHtml:function(e){var t=this._model.getNameLines();e.push("<a tabindex=\"0\" id=\"",this.getReferenceId(),"\" class=\"",this._getClassName(),"\" aria-haspopup=\"true\" role=\"button\" aria-labelledby=\"",this.id,"fullName\" onclick=\"",this.fireCode("show"),"return false;\" onkeypress=\"",this.fireCode("_keypressHandler"),"return false;\" aria-owns=\"",this._popup.getReferenceId(),"\">"),this._renderButtonContents(e),e.push("</a>"),e.addAfterRenderListener(this,"_updateOriginWidth")},cleanup:function(){for(var e in this._model.removeEventListener("personSelected",this),this._model.removeEventListener("showQuickcard",this),this._photo&&this._photo.cleanup(),this._cards)this._cards[e].cleanup();this._qcPopup&&this._qcPopup.cleanup(!1),this._super()},_keypressHandler:function(e){32==e.keyCode&&this.show()},show:function(){this._model.getOriginWidth()||this._updateOriginWidth(),this._super(),this.updateClassName(),this._model.reset()},_onPopupHidden:function(){this._super(),this.updateClassName()},updateContent:function(){this._initPhoto(),this._super(),this._updateOriginWidth()},getDomIdForPeopleSearch:function(){return this.getReferenceId()},_getPopupOptions:function(){var e=this._super();return e.fullScreen=o,e.fullScreenThreshold=s,e.stopTouchMove=!0,e},_createModel:function(e){return typeof e==SFPeoplePickerModel?e:new SFPeoplePickerModel(e)},_renderButtonContents:function(e){this._model.getEnablePhoto()&&(this._clickablePhoto&&e.push("<a href=\"javascript:void(0);\" rel=\"noopener\" class=\"viewFullPhoto\" onclick=\"",this.fireCode("_viewFullPhoto"),"\" title=\"",MSGS.COMMON_PEOPLEPICKER_VIEW_FULLSIZE,"\">"),e.push(this._photo),this._clickablePhoto&&e.push("</a>"));var t=this._model.getNameLines();1==t.length?e.push("<div id=\"",this.id,"fullName\" class=\"fullName\">",juic.escapeHTML(t[0]),"</div>"):2==t.length&&e.push("<div id=\"",this.id,"fullName\" class=\"fullName\"><span class=\"nameline1\">",juic.escapeHTML(t[0]),"</span><span class=\"nameline2\">",juic.escapeHTML(t[1]),"</span></div>"),this._model.getEnableQuickcard()&&e.push("<button id=\"",this.id,"qc\" class=\"cardButton globalModulePickerIcon\" onclick=\"",this.fireCode("_showQC"),"\" onfocus=\"",this.fireCode("_setFocusQC",!0),"\" onblur=\"",this.fireCode("_setFocusQC",!1),"\" aria-label=\"",MSGS.get("COMMON_QUICK_CARD_WITH_NAME",t.join(" ")),"\"></button>"),e.push("<span class=\"menuArrow globalModulePickerIcon\"></span>")},_setFocusQC:function(e){this._focused=e,this._updateOriginWidth()},_updateOriginWidth:function(){var e=juic.$(this.getReferenceId());e&&(this._longName=!1,e.className=this._getClassName(),e.offsetWidth>this._model.getNameWrapThreshold()&&(this._longName=!0,e.className=this._getClassName()),this._model.setOriginWidth(e.offsetWidth))},_createPopupContents:function(){var e=new SFPeoplePickerPopup(this._model);return e.addEventListener("reposition",this,"_onReposition"),e},_onReposition:function(){this._popup.reposition()},_getClassName:function(){var e=[this._super()];return this._customClass?e.push(this._customClass):(e.push(t,this._longName?"longName":"shortName"),e.push(AccessibilityPrefs.getLowVisionType()+"LowVision"),this._model.getEnableQuickcard()&&e.push("hasCard"),this._focused&&e.push("globalModulePickerHover")),this.isPopupShown()&&e.push("menuOpen"),e.join(" ")},_onUserChanged:function(e){this.updateContent(),this.dispatchEvent(e),this.hide()},_showQC:function(e){SFDOMEvent.stopPropagation(e),this._model.showQuickcard({user:this._model.getSelectedUser(),refocusRef:this.id+"qc",originId:this.id})},_onShowQuickcard:function(e){var t=e.user.userId,o=this._model.getQuickcardFactory();if(o){var s=this._cards[t]=this._cards[t]||o(juic.set({userId:t},n));this._qcPopup?this._qcPopup.setChild(s):this._qcPopup=new SFContextPopup(s,i),this._qcPopup.show(e.originId,{refocusRef:e.refocusRef}),this._qcPopup.isShown()&&s.setFocus()}}})})(),function(){var e=SFPeoplePicker.prototype,t=["fullName","firstName","lastName","middleInitial","userId","photoSrc"];for(var o in SFPeoplePickerModel.prototype.defaults)t.push(o);t.forEach(function(t){var o=t.charAt(0).toUpperCase()+t.substring(1);["get","set"].forEach(function(t){var s=t+o;e[s]=e[s]||function(){return this._model[s].apply(this._model,arguments)}})})}();