(function(){"use strict";function a(){var b=d.getSessionRef();b&&window.pageHeaderJsonData?d.init():window.jQuery&&!f?jQuery(function(){f=!0,a()}):20>e++&&setTimeout(a,100)}var b="lastPageVisitedPageInfoData",c="lastPageVisited",d=window.LastPageVisitedUtil={init:function(){if(d.isSkipRedirect()||!d.redirectToLastPageVisited()){d.setLastPageVisited();var a=d.getInitialLastPageVisited();a&&d.setLastPageVisited(a)}},redirectToLastPageVisited:function(){var a=d._getLocalStorageValue(d.getSessionRefStorageKey()),b=d.getSessionRef(),c=window.location.pathname,e=d._removeUnwantedQuerystringParams(window.location.href),f=window.pageHeaderJsonData,g=d._getLocalStorageValue(d.getRedirectStorageKey());return(d._storeSecurityCrumb(),!(!g||a===b||!d._isStartPage(c)&&d._isDeepLink(c)||e===g||f&&d._buildPageInfoData(f.pageInfo)===d._getLastPageVisitedPageInfo()&&d._isQuerystringMatch(window.location,g)))&&(window.location=g,!0)},ignoreLastPage:function(){var a=location.search,b=!1,c=window.pageHeaderJsonData;if(c&&c.utilityLinks){var d=c.utilityLinks.links;b=d&&d.some(function(a){return"PROXY_BECOME_SELF"===a.id})}return-1!=a.indexOf("saveLastPageSaved=false")||-1!=a.indexOf("bplte_logout=1")||0==location.pathname.indexOf("/sf/idp")||0==location.pathname.indexOf("/sf/logout")||0==location.pathname.indexOf("/sf/protected")||b},setLastPageVisited:function(a){var b,c,e;if(d.ignoreLastPage()||d._isNoStoreUrl(window.location.search))return void d.clearLastPageVisited();if(null!=d.getRedirectStorageKey()){if(a)e=a;else if(d._isDeepLink(window.location.pathname))e=window.location.href;else return void d.clearLastPageVisited();c=d.getRedirectStorageKey(),c&&(b=d._removeUnwantedQuerystringParams(e),d._setLocalStorage(c,b)),d._storeSecurityCrumb(),d._storeLastPageVisitedPageInfo()}},setCurrentPageAsLastVisited:function(){d.setLastPageVisited(location.pathname+location.search+location.hash)},clearLastPageVisited:function(){try{for(var a,b=[],d=new RegExp("_"+c+"$"),e=0;e<localStorage.length;e++)a=localStorage.key(e),d.test(a)&&b.push(a);b.forEach(function(a){localStorage.removeItem(a)})}catch(a){}},_storeLastPageVisitedPageInfo:function(){if(window.pageHeaderJsonData){var a=d._buildPageInfoData(pageHeaderJsonData.pageInfo);d._setLocalStorage(b,a)}},_storeSecurityCrumb:function(){d._setLocalStorage(d.getSessionRefStorageKey(),d.getSessionRef())},_getLastPageVisitedPageInfo:function(){return d._getLocalStorageValue(b)},_setLocalStorage:function(a,b){try{a&&window.localStorage&&localStorage.setItem(a,b)}catch(a){}},_getLocalStorageValue:function(a){try{if(a&&window.localStorage)return localStorage.getItem(a)}catch(a){}return null},setInitialLastPageVisited:function(a){d._initialLastPageVisited=a},getInitialLastPageVisited:function(){return d._initialLastPageVisited},getSessionRefStorageKey:function(){return"lastPageSessionRef"},isSkipRedirect:function(){var a=!!document.getElementById("skipLastPageRedirect");if(!a){var b=window.pageHeaderJsonData;a=b&&b.settings&&"true"==b.settings.skipLastPageRedirect}return a},getRedirectStorageKey:function(){var a,b,d=window.pageHeaderJsonData;if(d){var e=d.userInfo;b=e&&e.id||"",a=d.companyId||""}return a||(a=document.getElementById("companyInstanceId"),a&&(a=a.content)),b||(b=document.getElementById("userId"),b&&(b=b.content)),a&&b?[b,a,c].join("_"):null},_buildPageInfoData:function(a){var b="";return a&&(a.moduleId&&(b+=a.moduleId),a.pageId&&(b+=":"+a.pageId),a.pageQualifier&&(b+=":"+a.pageQualifier)),b},_isNoStoreUrl:function(a){return!!a&&-1!=a.indexOf("lastPageVisited=nostore")},_isQuerystringMatch:function(a,b){var c=document.createElement("a");c.href=b;var e=a.search;e=e?d._removeUnwantedQuerystringParams(e):"";var f=a.hash||"",g=c.search;g=g?d._removeUnwantedQuerystringParams(g):"";var h=c.hash||"";return e===g&&f===h},_removeUnwantedQuerystringParams:function(a){return d._removeQuerystringParams(a,["_s.crb","side-panel"])},_removeQuerystringParams:function(a,b){var c="",d=a.indexOf("#");0<=d&&(c=a.substring(d),a=a.substring(0,d)),b.forEach(function(b){a=a.replace(new RegExp("([?&])"+b+"=[^&]*(?:&|$)"),"$1")});var e=a.substring(a.length-1);return a="&"==e||"?"==e?a.substring(0,a.length-1):a,a+c},_isDeepLink:function(a){return /^\/sf\//i.test(a)},_isStartPage:function(a){return /^\/sf\/start/i.test(a)},generateHashCode:function(a){if(!a)return 0;for(var b,c=0,d=0;d<a.length;d++)b=a.charCodeAt(d),c=(c<<5)-c+b,c|=0;return c},getSessionRef:function(){var a=window.ajaxSecKey,b=window.pageHeaderJsonData;if(b){var c=b.companyId,d=b.userInfo||{},e=d.id,f=e+c+a,h=g[f];return!h&&a&&(h=g[a]=a.substr(0,4)+this.generateHashCode(f)),h}}},e=0,f=!1,g={};setTimeout(a,0)})();